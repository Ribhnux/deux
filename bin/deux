#!/usr/bin/env node
const globalPath = require('global-path')
const updateNotifier = require('update-notifier')
const pkg = require('../package.json')
const program = require('caporal')
const roadrunner = require('roadrunner')

// Load with roadrunner
roadrunner.load()

// Register global path
globalPath('helpers', '@/../src/helpers', '')
globalPath('const', '@/../src/helpers/constant', '')
globalPath('commands', '@/../src/cmd', '')
globalPath('templates', '@/../src/templates', '')

process.on('unhandledRejection', (err, p) => {
  const exit = global.helpers.require('logger/exit')
  console.log(p)
  exit(err)
})

program.version(pkg.version)
global.commands.require('new')
global.commands.require('status')
global.commands.require('switch')
global.commands.require('add')
global.commands.require('remove')
global.commands.require('dev')
program.parse(process.argv)

// Save roadrunner
roadrunner.save()

// Update notify code.
updateNotifier({
  pkg,
  updateCheckInterval: 1000 * 60 * 60 // Every hour
}).notify()
